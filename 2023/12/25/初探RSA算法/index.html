<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="p0l1st">



    <meta name="description" content="blog">



<title>初探RSA算法 | p0l1st&#39;s blog</title>



    <link rel="icon" href="/b.png">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="p0l1st's blog" type="application/atom+xml">
</head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">p0l1st&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">p0l1st&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">初探RSA算法</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">p0l1st</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">December 25, 2023&nbsp;&nbsp;0:11:51</a>
                        </span>
                    
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="RSA加密"><a href="#RSA加密" class="headerlink" title="RSA加密"></a>RSA加密</h1><p>RSA算法是现今使用最广泛的公钥密码算法。</p>
<p>根据密钥使用方法，可以将密码分为对称加密和非对称加密</p>
<ul>
<li>对称加密：加密和解密使用同一种密钥</li>
<li>公钥加密：加密和解密使用不同密钥</li>
</ul>
<p>RSA加密过程可以使用一个通式来表示</p>
<p><img src="/../images/image-20231224224841165.png" alt="image-20231224224841165"></p>
<p>也就是说RSA加密是对明文的E次方除以N后求余数的过程</p>
<p>只要知道E和N，任何人都可以进行RSA加密，所以E和N的组合就是公钥，用(E,N)来表示</p>
<p>E是加密(Encryption)，N是数字(Number)</p>
<h1 id="RSA解密"><a href="#RSA解密" class="headerlink" title="RSA解密"></a>RSA解密</h1><p>同样的，RSA解密也可以使用一个通式来表示</p>
<p><img src="/../images/image-20231224225157077.png" alt="image-20231224225157077"></p>
<p>RSA解密就是对密文的D次方除以N后求余数的过程</p>
<p>知道D和N就可以进行解密，所以D和N的组合就是私钥，用(D,N)表示</p>
<p>D是解密(Decryption),N是数字</p>
<h1 id="生成密钥对"><a href="#生成密钥对" class="headerlink" title="生成密钥对"></a>生成密钥对</h1><p>公钥是(E,N)，私钥是(D,N)，所以密钥对是(E,D,N)</p>
<p>密钥生成步骤如下:</p>
<ol>
<li><strong>求N</strong></li>
<li><strong>求L(计算过程的中间数)</strong></li>
<li><strong>求E</strong></li>
<li><strong>求D</strong></li>
</ol>
<h2 id="求N"><a href="#求N" class="headerlink" title="求N"></a>求N</h2><p>两个质数p，q(不能太小，容易破解)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">N = p * q</span><br></pre></td></tr></table></figure>

<h2 id="求欧拉函数φ-N"><a href="#求欧拉函数φ-N" class="headerlink" title="求欧拉函数φ(N)"></a>求欧拉函数φ(N)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">φ(N) = (p-1) * (q-1)</span><br></pre></td></tr></table></figure>

<h2 id="求E"><a href="#求E" class="headerlink" title="求E"></a>求E</h2><p>E需要满足两个条件</p>
<ul>
<li><strong>1 &lt; E &lt; φ(N)</strong></li>
<li><strong>gcd(E,φ(N)) &#x3D; 1(E和φ(N)最大公约数为1，即互质。)</strong></li>
</ul>
<p>需要E和φ(N)的最大公约数为1是为了保证一定存在解密时需要使用的数D。</p>
<h2 id="求D"><a href="#求D" class="headerlink" title="求D"></a>求D</h2><p>D由E计算出来，需要满足以下条件</p>
<ul>
<li><strong>1 &lt; D &lt; φ(N)</strong></li>
<li><strong>(E * D) mod φ(N) &#x3D; 1</strong></li>
</ul>
<p>只要D满足以上两个条件，由E和N进行加密的密文就可以使用D和N进行解密。</p>
<p>d可以使用**gmpy2.invert(e,φ(N))**求逆元快速计算出来。</p>
<h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><h2 id="python-gmpy2库"><a href="#python-gmpy2库" class="headerlink" title="python gmpy2库"></a>python gmpy2库</h2><p>**GMP(GNU Multiple Precision Arithmetic Library，即GNU高精度算术运算库)**，是一个开源的高精度运算库，其中不但有整数、实数、浮点数的高精度运算，还有随机数生成，尤其提供了非常完备的数论中的运算接口，比如Miller-Rabin素数测试算法、大素数生成、欧几里德算法、求域中元素的逆、Jacobi符号、legendre符号等。</p>
<p>gmpy2是python的一个扩展库，是对GMP的封装，前身是gmpy。</p>
<p><strong>常用函数：</strong></p>
<ul>
<li><strong>powmod(a,n,p)</strong> 对于给定的整数p,n,a,计算aⁿ mod p</li>
<li><strong>iroot(x,n)</strong>  对x开n次方根</li>
<li><strong>gcd(,a,b)</strong>  求得a,b最大公约数</li>
<li><strong>lcm(a,b)</strong>  求得最小公倍数</li>
<li><strong>invert(x,m)</strong>  求大整数x模m的逆元</li>
<li><strong>mpz()</strong>  初始化大整数</li>
</ul>
<h2 id="long-to-bytes"><a href="#long-to-bytes" class="headerlink" title="long_to_bytes()"></a>long_to_bytes()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br></pre></td></tr></table></figure>

<p>将正整数转化为byte类型字符串</p>
<h2 id="BUUCTF-Crypto-RSA"><a href="#BUUCTF-Crypto-RSA" class="headerlink" title="[BUUCTF-Crypto]RSA"></a>[BUUCTF-Crypto]RSA</h2><p>题目描述</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在一次RSA密钥对生成中，假设p=473398607161，q=4511491，e=17</span><br><span class="line">求解出d作为flga提交</span><br></pre></td></tr></table></figure>

<p>这里是已知p,q,e求d</p>
<p>前面提到，d可以d可以使用**gmpy2.invert(e,φ(N))<strong>求逆元快速计算，并且</strong>φ(N) &#x3D; (p-1) * (q-1)**，可以直接写出脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes </span><br><span class="line">p=<span class="number">473398607161</span></span><br><span class="line">q=<span class="number">4511491</span></span><br><span class="line">e=<span class="number">17</span></span><br><span class="line">d=gmpy2.invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20231224234655961.png" alt="image-20231224234655961"></p>
<p>最终flag为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;125631357777427553&#125;</span><br></pre></td></tr></table></figure>



<h2 id="BUUCTF-Crypto-rsarsa"><a href="#BUUCTF-Crypto-rsarsa" class="headerlink" title="[BUUCTF-Crypto]rsarsa"></a>[BUUCTF-Crypto]rsarsa</h2><p>题目描述</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Math is cool! Use the RSA algorithm to decode the secret message, c, p, q, and e are parameters for the RSA algorithm.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p =  9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483</span><br><span class="line">q =  11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407</span><br><span class="line">e =  65537</span><br><span class="line">c =  83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034</span><br><span class="line"></span><br><span class="line">Use RSA to find the secret message</span><br></pre></td></tr></table></figure>

<p>已知p、q、e，c，求m</p>
<p>首先可以根据p和q求出n和L，然后根据e和l求出d，最后根据**m&#x3D;pow(c,d,n)**求出m</p>
<p>脚本如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  gmpy2</span><br><span class="line">p =  <span class="number">9648423029010515676590551740010426534945737639235739800643989352039852507298491399561035009163427050370107570733633350911691280297777160200625281665378483</span></span><br><span class="line">q =  <span class="number">11874843837980297032092405848653656852760910154543380907650040190704283358909208578251063047732443992230647903887510065547947313543299303261986053486569407</span></span><br><span class="line">e =  <span class="number">65537</span></span><br><span class="line">c =  <span class="number">83208298995174604174773590298203639360540024871256126892889661345742403314929861939100492666605647316646576486526217457006376842280869728581726746401583705899941768214138742259689334840735633553053887641847651173776251820293087212885670180367406807406765923638973161375817392737747832762751690104423869019034</span></span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line">L = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,L)</span><br><span class="line">m = gmpy2.powmod(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20231224235558624.png" alt="image-20231224235558624"></p>
<p>最终flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;5577446633554466577768879988&#125;</span><br></pre></td></tr></table></figure>



<h2 id="琢光杯2023-初见RSA"><a href="#琢光杯2023-初见RSA" class="headerlink" title="[琢光杯2023] 初见RSA"></a>[琢光杯2023] 初见RSA</h2><p>解题思路跟上题差不多，由于平台关了我这没有保存题目描述。只有解题脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">c = <span class="number">9834481633369584189157728591978435618337259149694081678309646658277058618867</span></span><br><span class="line">p = <span class="number">332105137874944395742297540023188374897</span></span><br><span class="line">q = <span class="number">68159029643028420042825342940314147679</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line">L = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e,L)</span><br><span class="line">m = gmpy2.powmod(c,d,n)</span><br><span class="line">flag = long_to_bytes(m+n)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>当时疑惑的点是m是最终解密的明文，为什么还要加n</p>
<p>GPT给出回答是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">至于为什么最后要加n的问题，其实这是一个巧妙的解决方案。在某些情况下，由于数值的取整或者舍入等原因，可能会导致解密出来的明文m比实际的明文小一个n。为了恢复到正确的明文，我们可以尝试将解密出来的明文m加上n，来看是否能得到正确的结果。</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20231225001055831.png" alt="image-20231225001055831"></p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>p0l1st</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="http://example.com/2023/12/25/%E5%88%9D%E6%8E%A2RSA%E7%AE%97%E6%B3%95/">http://example.com/2023/12/25/%E5%88%9D%E6%8E%A2RSA%E7%AE%97%E6%B3%95/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Crypto/"># Crypto</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2023/12/27/Fast-destruct/">Fast destruct</a>
            
            
            <a class="next" rel="next" href="/2023/12/23/%E4%BB%8E%E4%B8%80%E9%81%93%E9%A2%98%E5%AD%A6%E4%B9%A0LFI%E5%8C%85%E5%90%ABpearcmd%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">从一道题学习LFI包含pearcmd命令执行</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© p0l1st | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>